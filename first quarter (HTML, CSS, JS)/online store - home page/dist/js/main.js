function Container(t){this.id=t,this.htmlCode=""}function Basket(t){Container.call(this,t),this.countGoods=0,this.amount=0,this.basketItems=[],this.loadBasketItems()}function Product(t,a,e,s){Container.call(this,t),this.title=a,this.price=e,this.imageSrc=s,this.href="#"}Container.prototype.render=function(){return this.htmlCode},Container.prototype.remove=function(){},Basket.prototype=Object.create(Container.prototype),Basket.prototype.constructor=Basket,Basket.prototype.render=function(t){var a=$("<div />",{id:this.id}),e=$("<div />",{id:this.id+"_items"}),s=$("<div />",{id:this.id+"_data"}),n=$("<a />",{href:"./shopping-cart.html",class:"basketButton",text:"Go to cart"}),o=$("<a />",{href:"./checkout.html",class:"basketButton",text:"Checkout"});e.appendTo(a),s.appendTo(a),n.appendTo(a),o.appendTo(a),a.appendTo(t)},Basket.prototype.loadBasketItems=function(){this.id;$.get({url:"basket.json",dataType:"json",context:this,success:function(t){var a=$("#basket_data");this.countGoods=t.basket.length,this.amount=t.amount,a.append('<p class="total"><span>Quantity:</span><span>'+this.countGoods+"</span></p>"),a.append('<p class="total"><span>Total:</span><span>'+this.amount+"$</span></p>");for(var e in t.basket)this.basketItems.push(t.basket[e])}})},Basket.prototype.addProduct=function(t,a,e,s){var n={id_product:t,src_image:a,title:e,price:s};this.countGoods++,this.amount+=s;var o=$("#basket_items");if(o.is(':has([data-id="'+t+'"])')){var i=+$("#basket_items").find('[data-id="'+t+'"]').find(".quantity__value").text();$("#basket_items").find('[data-id="'+t+'"]').find(".quantity__value").text(""+ ++i)}else{var r=$('<div class="productInBasket" data-id="'+t+'"></div>'),d=$('<img src="'+a+'" class="productInBasket__image" alt="'+e+'">'),p=$('<a href="#" class="productInBasket__name">'+e+"</a>"),c=$('<span class="productInBasket__remove productInBasket__button"><i class="fa fa-times" aria-hidden="true"></i></span>'),u=$('<p class="productInBasket__price">'+s+" $</p>"),h=$('<div class="productInBasket__quantity"><span class="productInBasket__button quantity quantity__reduce"><i class="fa fa-minus" aria-hidden="true"></i></span><span class="quantity__value">1</span><span class="productInBasket__button quantity quantity__add"><i class="fa fa-plus" aria-hidden="true"></i></span></div>');d.appendTo(r),p.appendTo(r),c.appendTo(r),u.appendTo(r),h.appendTo(r),o.append(r),this.basketItems.push(n)}this.refresh()},Basket.prototype.removeProduct=function(t,a,e){var s=a*e;$("#basket_items").find('[data-id="'+t+'"]').remove(),this.countGoods-=a,this.amount-=s,this.countGoods?$(".cart__quantityProduct").html(this.countGoods):$(".cart__quantityProduct").fadeOut(500).html(this.countGoods),this.refresh()},Basket.prototype.quantityAdd=function(t,a,e){$("#basket_items").find('[data-id="'+t+'"]').find(".quantity__value").text(""+ ++a),this.countGoods++,this.amount+=e,$(".cart__quantityProduct").html(this.countGoods),this.refresh()},Basket.prototype.quantityReduce=function(t,a,e){a>1?$("#basket_items").find('[data-id="'+t+'"]').find(".quantity__value").text(""+--a):$("#basket_items").find('[data-id="'+t+'"]').remove(),this.countGoods--,this.amount-=e,this.countGoods?$(".cart__quantityProduct").html(this.countGoods):$(".cart__quantityProduct").fadeOut(500).html(this.countGoods),this.refresh()},Basket.prototype.showQuantityProduct=function(){this.countGoods>0&&$(".cart__quantityProduct").fadeIn(500).html(this.countGoods)},Basket.prototype.refresh=function(){var t=$("#basket_data");t.empty(),t.append('<p class="total"><span>Quantity:</span><span>'+this.countGoods+"</span></p>"),t.append('<p class="total"><span>Total:</span><span>'+this.amount+"$</span></p>")},Product.prototype=Object.create(Container.prototype),Product.prototype.constructor=Product,Product.prototype.render=function(t){var a=$("<div />",{class:"product"}),e=$("<div />",{class:"product__image"}),s=$('<img src="'+this.imageSrc+'" class="product__photo" alt="'+this.title+'">'),n=$("<a />",{class:"product__link",href:this.href}),o=$("<button />",{class:"product__addToCart","data-id":this.id,title:"Нажми, чтобы добавить в корзину"}),i=$('<img src="./image/forma-1-copy.png" class="addToCart__image" alt="Корзина">'),r=$('<h4 class="addToCart__head">Add to Cart</h4>'),d=$('<a href="#" class="product__name">'+this.title+"</a>"),p=$('<p class="product__price">Цена: <span class="price">'+this.price+"</span> $</p>");i.appendTo(o),r.appendTo(o),s.appendTo(e),n.appendTo(e),o.appendTo(e),e.appendTo(a),d.appendTo(a),p.appendTo(a),t.append(a)},$(document).ready(function(){$.get({url:"./products.json",success:function(t){$.each(t,function(){new Product(this.id,this.title,this.price,this.imageSrc).render($(".products-box"))})},dataType:"json"});var t=new Basket("basket");t.render($(".basket-box")),$(".products-box").on("click",".product__addToCart",function(){var a=parseInt($(this).attr("data-id")),e=$(this).parent().find(".product__photo").attr("src"),s=$(this).parent().parent().find(".product__name").text(),n=parseInt($(this).parent().parent().find(".price").text());t.addProduct(a,e,s,n),t.showQuantityProduct()}),$(".basket-box").on("click",".productInBasket__remove",function(){var a=parseInt($(this).parent().attr("data-id")),e=parseInt($(this).parent().find(".productInBasket__quantity").text()),s=parseInt($(this).parent().find(".productInBasket__price").text());console.log(a,e,s),t.removeProduct(a,e,s)}),$(".basket-box").on("click",".quantity__add",function(){var a=parseInt($(this).parent().parent().attr("data-id")),e=parseInt($(this).parent().find(".quantity__value").text()),s=parseInt($(this).parent().parent().find(".productInBasket__price").text());console.log(a,e,s),t.quantityAdd(a,e,s)}),$(".basket-box").on("click",".quantity__reduce",function(){var a=parseInt($(this).parent().parent().attr("data-id")),e=parseInt($(this).parent().find(".quantity__value").text()),s=parseInt($(this).parent().parent().find(".productInBasket__price").text());console.log(a,e,s),t.quantityReduce(a,e,s)}),$(".header__cart").on("click",function(){$(".basket-box").fadeToggle(1e3)})});